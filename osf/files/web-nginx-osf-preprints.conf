location ~* "^/preprints/((\w+)/){0,2}((edit|submit|assets)\b).*" {
    {{- if .Values.prerender.enabled }}
    include /etc/nginx/prerender.conf;
    {{- end }}

    {{- range .Values.web.nginx.preprintRewrites }}
    {{ . }}
    {{- end }}

    rewrite ^/preprints/(.*)$ /$1 break;
    proxy_redirect off;
    proxy_buffering off;
    proxy_pass http://{{ (index .Values "osf-preprints").service.name }}:{{ (index .Values "osf-preprints").service.externalPort }};
}

location ~* ^/preprints/(?!(\w+/download|\w+/\w+/download)/?$).* {
    {{- if .Values.prerender.enabled }}
    include /etc/nginx/prerender.conf;
    {{- end }}

    {{- range .Values.web.nginx.preprintRewrites }}
    {{ . }}
    {{- end }}

    rewrite ^/preprints/(.*)$ /$1 break;
    proxy_redirect off;
    proxy_buffering off;
    proxy_pass http://{{ (index .Values "osf-web").service.name }}:{{ (index .Values "osf-web").service.externalPort }};
}