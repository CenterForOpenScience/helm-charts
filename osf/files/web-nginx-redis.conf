# Must use redis module vs redis2 because of bug in response body
# https://github.com/openresty/srcache-nginx-module/issues/41
location = /redis_get {
    internal;

    set_unescape_uri $redis_key $arg_key;
    set_md5 $redis_key;

    redis_pass {{ .Release.Name }}-redis:{{ .Values.redis.service.port }};
}

location = /redis2_set {
    internal;

    set_unescape_uri $exptime $arg_exptime;
    set_unescape_uri $key $arg_key;
    set_md5 $key;

    redis2_query set $key $echo_request_body;
    redis2_query expire $key $exptime;
    redis2_pass {{ .Release.Name }}-redis:{{ .Values.redis.service.port }};
}