# NOTE: $not_cacheable is set via map in order to be available at the correct phase for srcache skip
# https://github.com/openresty/srcache-nginx-module#caveats

# Caching configuration
set $key "$host$uri$args_first$args_rest";
set_escape_uri $escaped_key $key;
# Default cache methods, specified for clarity.
srcache_methods GET HEAD;
  # Skip cache when:
# - logged in
# - using basic auth
# - view-only link
# - hmac signed
# - waterbutler provider
# - monitoring agent

srcache_fetch_skip $not_cacheable;
srcache_store_skip $not_cacheable;

srcache_fetch GET /redis_get key=$escaped_key;
srcache_store PUT /redis2_set key=$escaped_key&exptime=$exp_time;

# Custom Cache Header
add_header X-Cache-Status $srcache_fetch_status;