set $agent_monitor 0;
if ($http_user_agent ~* "(haproxy monitoring|rackspace monitoring|varnish|runscope-radar)") {
    set $agent_monitor 1;
}

# Custom Cache Header
add_header X-Cache-Status $upstream_cache_status;

# Caching configuration
uwsgi_cache osf_uwsgi_cache;
uwsgi_cache_key $host$uri$args_first$args_rest;
# Default cache methods, specified for clarity.
uwsgi_cache_methods GET HEAD;
# Skip cache when:
# - logged in
# - using basic auth
# - view-only link
# - hmac signed
# - waterbutler provider
# - monitoring agent
uwsgi_cache_bypass $cookie_{{ .Values.web.nginx.cache.cookieName }} $http_authorization $arg_view_only $arg_signature $arg_provider $arg_render $agent_monitor;
uwsgi_no_cache $cookie_{{ .Values.web.nginx.cache.cookieName }} $http_authorization $arg_view_only $arg_signature $arg_provider $arg_render $agent_monitor;
uwsgi_cache_lock on;
uwsgi_cache_lock_timeout 30s;
uwsgi_cache_use_stale updating;